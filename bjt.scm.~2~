(define (bjt-active-beta-model VBEthreshold VCEsaturation beta
                               #!optional given-name)
  (3-terminal-device '(bjt-active-beta-model b c e) given-name
    (lambda (VBE IB VCE IC)
      (let-cells (type                ;+ for NPN, - for PNP
                  VBEsign VCEsign IBsign ICsign
                  absVBEthreshold absVCEsaturation
		  absVBE absVCE absIC alpha
                  (false #f))

        (sign VBEthreshold type)

        (same VBEsign type)
        (sign VBE VBEsign)

        (same VCEsign type)
        (sign VCE VCEsign)

        (same IBsign type)
        (sign IB IBsign)

        (same ICsign type)
        (sign IC ICsign)

        (absolute-value VBEthreshold absVBEthreshold)
        (absolute-value VBE absVBE)

        (absolute-value VCEsaturation absVCEsaturation)

        ;; Active transistor
        (<=? absVCE absVCEsaturation false)    ;Not saturated
        (same VBE VBEthreshold)                ;Not cutoff
        (product beta IB IC)
	(product alpha IE IC)

	))
    VBEthreshold VCEsaturation beta))

(define (bjt-active-EberMoll-model VBEthreshold VCEsaturation beta IS
                                   #!optional given-name)
  (3-terminal-device '(bjt-active-EberMoll-model b c e) given-name
    (lambda (VBE IB VCE IC)
      (let-cells (type                ;+ for NPN, - for PNP
                  VBEsign VCEsign IBsign ICsign
                  absVBEthreshold absVCEsaturation
		  absVBE absVCE absIC alpha
                  (false #f))

        (sign VBEthreshold type)

        (same VBEsign type)
        (sign VBE VBEsign)

        (same VCEsign type)
        (sign VCE VCEsign)

        (same IBsign type)
        (sign IB IBsign)

        (same ICsign type)
        (sign IC ICsign)

        (absolute-value VBEthreshold absVBEthreshold)
        (absolute-value VBE absVBE)

        (absolute-value VCEsaturation absVCEsaturation)

        ;; Active transistor
        (<=? absVCE absVCEsaturation false)    ;Not saturated
        ((exponential-diode IS q/kT) VBE IE)
        (product beta IB IC)
	(product alpha IE IC)

	))
    VBEthreshold VCEsaturation beta IS))

(define (exponential-diode IS q/kT #!optional given-name)
  (2-terminal-device '(exponential-diode anode cathode) given-name
    (lambda (v i)
      (let-cells (v*q/kT e^v*q/kT e^v*q/kT-1 (one 1))
        (product v q/kT v*q/kT)
        (
      )
    IS q/kT))
